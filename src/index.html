<!DOCTYPE>
<html>
<head>
</head>
<body>
  <p>
    <input class="room" name="room" value="roomname" placeholder="Room" />
    <button class="join">Join</button>
  </p>
  <p>
    <span>Vote</span>
    <input class="vote" name="vote" placeholder="Vote Value" />
  </p>
  <p>
    <span>User</span>
    <input class="user" name="user" placeholder="User Name" />
  </p>
    <button class="send">Send</button>
    <div class="console"></div>
  </p>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
  <script>
  var game = {};

  function update() {
    $('.console').text(JSON.stringify(game));
  }

  $('.join').on('click', function() {
    var socket = io.connect('http://localhost:3333');

    socket.on('connect', function() {
        socket.emit('join', { gameId: $('.room').val(), playerId: $('.user').val() });
    });

    socket.on('disconnect', function() {
      io.to($('.room').val()).emit('leave', { gameId: $('.room').val(), playerId: $('.user').val() });
    });

    socket.on('error', function (data) {
      update(JSON.stringify(data));
    });
    socket.on('voteUpdated', function (data) {
      game[data.playerId] = data.vote;
      update();
    });
    socket.on('playerLeft', function (data) {
      delete game[data.playerId];
      update();
    });
    socket.on('playerJoined', function (data) {
      game[data.playerId] = null;
      update();
    });
    socket.on('connected', function (data) {
      game = data.votes;
      game[$('.user').val()] = null;
      update();
    });

    $('.send').on('click', function() {
      game[$('.user').val()] = $('.vote').val();
      socket.emit('vote', { gameId: $('.room').val(), playerId: $('.user').val(), vote: $('.vote').val() });
    });
  });
  </script>
</body>
</html>
